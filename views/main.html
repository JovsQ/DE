<div id="wrapper" ng-init="fetchReadings()">

    <div id="page-wrapper">
        <div class="row">

            <div style="display: flex; flex-direction: row; align-items: center; width: 100%; flex-wrap: wrap;">
                <div style="display: flex; flex: 2; align-self: flex-start;">
                    <img ng-src="images/denr_logo.png" style="width: 150px; height: 100px;">
                </div>
                <div style="display: flex; align-self: center; justify-content: center; align-items: center; flex: 6">
                    <h1>Emission Inventory Compilation WebApp</h1>    
                </div>
                <div style="display: flex; flex: 2;">
                </div>
            </div>

            <div style="display: flex; justify-content: flex-end; padding-right: 50px; font-style: italic;">MASS RATE Expressed in TONS/YEAR</div>   

            <div style="display: flex; flex-direction: row; justify-content: space-between; flex-wrap: wrap; width: 100%; margin-top: 10px; margin-bottom: 10px;">
                <div style="display: flex; flex: 1; padding: 5px;">
                    <select class="form-control" ng-model="current_year.year" ng-change="fetchReadings()">
                        <option value='' selected="true" disabled="disabled">Select Year</option>
                        <option ng-repeat="year in years" ng-value="year.year">{{year.year}}</option>
                    </select>
                </div>
                <div style="display: flex; flex: 1; padding: 5px">
                    <button style="width: 100%" class="btn btn-success" ng-click="addYear()">Add Year</button>    
                </div>
                <div style="display: flex; flex: 1; padding: 5px">
                    <button style="width: 100%" class="btn btn-success" ng-click="addRegion()" ng-disabled="!current_year.year">Add Region</button>
                </div>
                <div style="display: flex; flex: 1; padding: 5px">
                    <button style="width: 100%" class="btn btn-success" ng-click="addPollutant()" ng-disabled="!current_year.year">Add Pollutant</button>
                </div>
                <div style="display: flex; flex: 1; padding: 5px">
                    <button style="width: 100%" class="btn btn-success" ng-click="addEntry()" ng-disabled="!current_year.year">Add / Update Reading</button>
                </div>
                <div style="display: flex; flex: 1; padding: 5px; flex-direction: row;">
                    <label style="display: flex; flex: 1; justify-content: center; align-items: center;">Sort by: </label>
                    <select class="form-control" ng-init="selected_sort = sorting_options[0]" ng-model="selected_sort" ng-change="hasSelectedSort()" style="display: flex; flex: 1.5;" ng-disabled="!current_year.year">
                        <option ng-repeat="sort in sorting_options" ng-value="sort">{{sort}}</option>
                    </select>
                </div>
                <div style="display: flex; flex: 1; padding: 5px; flex-direction: row;">
                    <label style="display: flex; flex: 1; justify-content: center; align-items: center;">Filter by: </label>
                    <select class="form-control" ng-init="selected_filter = filtering_options[0]" ng-model="selected_filter" ng-change="hasSelectedFilter()" style="display: flex; flex: 1.5;" ng-disabled="!current_year.year">
                        <option ng-repeat="filter in filtering_options" ng-value="filter">{{filter}}</option>
                    </select>
                </div>
            </div>    

            <div class="row">
                <div class="col-lg-12">
                        <div class="table-responsive">
                            <table class="table table-striped table-bordered" style="overflow: auto; white-space: nowrap;" >
                            <thead>
                                <tr>
                                    <th>REGION</th>
                                    <th>LAT</th>
                                    <th>LONG</th>
                                    <th>SOURCE</th>                                    
                                    <th ng-repeat="pollutant in pollutants_header track by $index">{{pollutant}}</th>
                                    <th style="color: red">TOTAL</th>
                                    <th style="color: red">Regional %</th>
                                </tr>
                            </thead>

                            <tbody ng-repeat="region in regions">
                                <tr>
                                    <!-- region -->
                                    <td rowspan="3" class="labels" style="vertical-align: middle !important">{{region.region}}</td>

                                    <!-- lat -->
                                    <td rowspan="3" class="labels" style="vertical-align: middle !important">{{region.latitude}}</td>

                                    <!-- long -->
                                    <td rowspan="3" class="labels" style="vertical-align: middle !important">{{region.longitude}}</td>

                                    <!-- stationary -->
                                    <td class="labels" style="color: red">
                                        {{getSource()}}
                                    </td>
                                    
                                    <!-- pollutants -->
                                    <td ng-repeat="value in getReadingsByValue(region.region, 'Station') track by $index">
                                       {{value}}
                                    </td>
                                </tr>

                                <tr ng-show="showFiltered('Mobile')">
                                    <!-- stationary -->
                                    <td class="labels" style="color: red">
                                        Mobile
                                    </td>

                                    <!-- pollutants -->
                                    <td ng-repeat="value in getReadingsBy(region.region, 'Mobile') track by $index">
                                       {{value}}
                                    </td>
                                </tr>

                                <tr ng-show="showFiltered('Area')">
                                    <!-- area -->
                                    <td class="labels" style="color: red">
                                        Area
                                    </td>
                                   
                                    <!-- pollutants -->
                                    <td ng-repeat="value in getReadingsBy(region.region, 'Area') track by $index">
                                       {{value}}
                                    </td>
                                </tr>
                            </tbody>

                            <tbody>
                                <!-- <th colspan="4">Grand Total</th>                                  
                                <th colspan="2" ng-repeat="pollutant in pollutants track by $index">{{getPollutantTotal(pollutant.pollutant, $index)}}</th>
                                <th colspan="2" style="color: red">{{getPollutantGrandTotal()}}</th> -->

                                <tr>
                                    <!-- region -->
                                    <th rowspan="3" colspan="3" class="labels" style="vertical-align: middle !important">Grand Total</th>

                                    <!-- stationary -->
                                    <th class="labels" style="color: red">
                                        Stationary
                                    </th>
                                    
                                    <!-- pollutants -->
                                    <td ng-repeat="value in getTotalReadingsBy('Station') track by $index" style="font-weight: bold;">
                                       {{value}}
                                    </td>
                                </tr>

                                <tr>
                                    <!-- stationary -->
                                    <th class="labels" style="color: red">
                                        Mobile
                                    </th>

                                    <!-- pollutants -->
                                    <td ng-repeat="value in getTotalReadingsBy('Mobile') track by $index"
                                    style="font-weight: bold;">
                                       {{value}}
                                    </td>
                                </tr>

                                <tr>
                                    <!-- area -->
                                    <th class="labels" style="color: red">
                                        Area
                                    </th>
                                   
                                    <!-- pollutants -->
                                    <td ng-repeat="value in getTotalReadingsBy('Area') track by $index"
                                    style="font-weight: bold;">
                                       {{value}}
                                    </td>
                                </tr>

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <!-- /.row -->
        
    </div>
    <!-- /#page-wrapper -->

</div>
<!-- /#wrapper -->